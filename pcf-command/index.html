<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">

	<title>PCF Command - ISV Portal</title>

        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../css/highlight.css">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="..">ISV Portal</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="..">Home</a>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Developer Guide <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../getting-started/">Getting Started</a>
</li>

                        
                            
<li >
    <a href="../cf-concepts/">Cloud Foundry Concepts</a>
</li>

                        
                            
<li >
    <a href="../integration-types/">Integration Types</a>
</li>

                        
                            
<li >
    <a href="../stages/">Stages of Integration</a>
</li>

                        
                            
<li >
    <a href="../development/">Development Process</a>
</li>

                        
                            
<li >
    <a href="../tile-documentation/">Documentation</a>
</li>

                        
                            
<li >
    <a href="../concourse/">Continuous Integration</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Reference <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Commands</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../tile-generator/">Tile Generator</a>
</li>

        
            
<li class="active">
    <a href="./">PCF Command</a>
</li>

        
            
<li >
    <a href="../concourse/">Concourse</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Components</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../service-brokers/">Service Brokers</a>
</li>

        
            
<li >
    <a href="../managed-services/">Managed Services</a>
</li>

        
            
<li >
    <a href="../dynamic-services/">Dynamic Services</a>
</li>

        
            
<li >
    <a href="../buildpacks/">Buildpacks</a>
</li>

        
            
<li >
    <a href="../embedded-agents/">Embedded Agents</a>
</li>

        
    </ul>
  </li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Setup</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../setup-pcfdev/">PCF Dev</a>
</li>

        
            
<li >
    <a href="../setup-pcf/">PCF</a>
</li>

        
    </ul>
  </li>

                        
                        </ul>
                    </li>
                
                
                
                    <li >
                        <a href="../contacts/">Contacts</a>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li >
                        <a rel="next" href="../tile-generator/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../concourse/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#pcf-utility">PCF Utility</a></li>
        
            <li><a href="#authentication">Authentication</a></li>
        
    
        <li class="main "><a href="#commands">Commands</a></li>
        
            <li><a href="#checking-ops-manager-settings">Checking Ops Manager Settings</a></li>
        
            <li><a href="#testing-errands">Testing Errands</a></li>
        
            <li><a href="#deploying-tiles">Deploying Tiles</a></li>
        
            <li><a href="#removing-tiles">Removing Tiles</a></li>
        
            <li><a href="#accessing-elastic-runtime">Accessing Elastic Runtime</a></li>
        
    
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="pcf-utility">PCF Utility</h1>
<p>The <code>pcf</code> utility provides a command line interface to Pivotal Cloud Foundry for
the purpose of deploying and testing tiles. Its primary reason for existence is
to enable Ops Manager access from CI pipelines, but developers also find it
convenient to use this CLI rather than the Ops manager GUI.</p>
<p>The <code>pcf</code> utility also allows you to test your tile's BOSH errands
directly from your CLI, without going through Ops Manager and BOSH. This greatly
reduces the time it takes to deploy/test each iteration of your software components.</p>
<h2 id="authentication">Authentication</h2>
<p>The <code>pcf</code> utility looks for a file called <code>metadata</code> in the current directory.
This file is expected to provide the URL and credentials to connect to
Ops Manager, in the following format:</p>
<pre><code class="yaml">---
opsmgr:
    url: https://opsmgr.example.com
    username: admin
    password: &lt;redacted&gt;
</code></pre>

<p>The reason for this file naming is because this is how Concourse passes
credentials of a "claimed" PCF pool resource to the CI pipeline scripts.
For interactive use, this means that you will have to create a <code>metadata</code>
file in the directory where you run the <code>pcf</code> command.</p>
<p><em>We recommend that you do</em> <strong>not</strong> <em>create this file inside your git (or other
version control system) repository, as you do not want to accidentally commit
these credentials to version control.</em></p>
<h1 id="commands">Commands</h1>
<p>The <code>pcf</code> utility implements many different commands. To see available commands:</p>
<pre><code class="bash">$ pcf --help
Usage: pcf [OPTIONS] COMMAND [ARGS]...

Options:
  --help  Show this message and exit.

Commands:
  apply-changes
  cf-info
  changes
  configure
  delete-unused-products
  import
  install
  is-available
  is-installed
  logs
  products
  settings
  target
  test-errand
  uninstall
</code></pre>

<h2 id="checking-ops-manager-settings">Checking Ops Manager Settings</h2>
<p>To see which products are currently available and installed in Ops Manager:</p>
<pre><code class="bash">$ pcf products
- p-bosh 1.7.0.0 (installed)
- cf 1.7.0-build.258 (installed)
- test-tile 0.3.95
</code></pre>

<p>To test if a specific product is available or installed from within a script:</p>
<pre><code class="bash">$ pcf is-available test-tile &amp;&amp; echo &quot;Product test-tile is available&quot;
$ pcf is-installed test-tile &amp;&amp; echo &quot;Product test-tile is installed&quot;
</code></pre>

<p>You can retrieve the settings for a specific product (this will give you a <em>lot</em> of json):</p>
<pre><code class="bash">$ pcf settings test-tile
{
    &quot;network_reference&quot;: &quot;669e213111ab5aa1008a&quot;,
    &quot;guid&quot;: &quot;test-tile-be3e50cf26c530acca6e&quot;,
    &quot;jobs&quot;: [
        {
            &quot;instance&quot;: {
                &quot;identifier&quot;: &quot;instances&quot;
            },
            &quot;identifier&quot;: &quot;compilation&quot;,
            &quot;guid&quot;: &quot;compilation-066a85d82fbcd936f9d7&quot;,
            &quot;installation_name&quot;: &quot;compilation&quot;,
            &quot;vm_credentials&quot;: {
                &quot;password&quot;: &lt;redacted&gt;,
                &quot;salt&quot;: &lt;redacted&gt;,
                &quot;identity&quot;: &quot;vcap&quot;
            }
        },
        {
            &quot;guid&quot;: &quot;deploy-all-b83a7cb7be00ebfd26d6&quot;,
            &quot;vm_credentials&quot;: {
    ...
</code></pre>

<h2 id="testing-errands">Testing Errands</h2>
<p>You can test your tile's BOSH errands directly from your current shell. Deploy
your tile's packages using:</p>
<pre><code class="bash">$ pcf test-errand test-tile-repo deploy-all
/usr/local/bin/cf version 6.15.0+fa1bfe2-2016-01-13
cf api https://api.run-04.example.com --skip-ssl-validation
cf auth system_services &lt;redacted&gt;
cf target -o test-tile-org
cf update-quota test-tile-org-quota -m 4096m -r 1000 -s 100
cf update-quota test-tile-org-quota --allow-paid-service-plans
cf set-quota test-tile-org test-tile-org-quota
cf target -s test-tile-space
cf bind-running-security-group all_open
cf push app1-0.0.2 -n app1 -d cfapps-04.example.com -f sample/release/blobs/app1/manifest.yml --no-start
cf set-env app1-0.0.2 UAA_HOST https://uaa.run-04.example.com
cf set-env app1-0.0.2 CC_HOST https://api.run-04.example.com
cf set-env app1-0.0.2 LOGIN_HOST https://login.run-04.example.com
cf set-env app1-0.0.2 ROOT $HOME
cf set-env app1-0.0.2 SCHEME https
cf set-env app1-0.0.2 VERIFY_SSL True
cf set-env app1-0.0.2 CF_ORG test-tile-org
cf set-env app1-0.0.2 CF_SPACE test-tile-space
cf set-env app1-0.0.2 CF_TARGET https://api.run-04.example.com
cf set-env app1-0.0.2 SECURITY_USER_NAME admin
...

</code></pre>

<p>Delete them using:</p>
<pre><code class="bash">$ pcf test-errand test-tile-repo delete-all
/usr/local/bin/cf version 6.15.0+fa1bfe2-2016-01-13
cf api https://api.run-04.example.com --skip-ssl-validation
cf auth system_services &lt;redacted&gt;
cf delete -f app3-0.0.2
cf delete-buildpack -f noop_buildpack
cf purge-service-offering -f service-broker2-service
cf delete-service-broker -f service-broker2
cf delete -f service-broker2-0.0.2
cf delete -f app2-0.0.2
cf purge-service-offering -f service-broker1-service
cf delete-service-broker -f service-broker1
cf delete -f service-broker1-0.0.2
cf delete -f app1-0.0.2
cf delete-space -f test-tile-space
cf delete-org -f test-tile-org
cf delete-quota -f test-tile-org-quota

</code></pre>

<p>This <em>only</em> reliably works for the above two errands generated by the tile
generator. If your tile includes any packages that are not deployed into them
Elastic Runtime, such as docker-bosh packages, those will not be deployed when
using this method.</p>
<h2 id="deploying-tiles">Deploying Tiles</h2>
<p>Once your software works and correctly deploys using <code>test-errand</code>, you can go
through the real Ops Manager deployment process from the CLI, as you would
normally do through the Ops Manager GUI.</p>
<p>Import your .pivotal file into Ops Manager:</p>
<pre><code class="bash">$ pcf import sample/product/test-tile-0.0.2.pivotal
</code></pre>

<p>Install the uploaded version of your product:</p>
<pre><code class="bash">$ pcf install test-tile 0.0.2
</code></pre>

<p>Where you would normally configure the tile settings in the GUI, the <code>configure</code>
command lets you pass in any user-specified properties as a .yml file. This command
also sets the stemcell for the tile to the same one used by your Elastic Runtime,
to avoid the need to upload a tile-specific stemcell.</p>
<pre><code class="bash">$ pcf configure test-tile sample/missing-properties.yml
- Using stemcell bosh-vsphere-esxi-ubuntu-trusty-go_agent version 3215
</code></pre>

<p>The property file looks like this:</p>
<pre><code class="yaml">---
customer_name: Jimmy's Johnnys
street_address: Cartaway Alley
city: New Jersey
country: US
app2:
  persistence_store_type: none
</code></pre>

<p>To see what changes are ready to be applied:</p>
<pre><code class="bash">$ pcf changes
install: test-tile-207b165fcb7dc8b2597b
delete:  
</code></pre>

<p>To apply these changes:</p>
<pre><code class="bash">$ pcf apply-changes
  ===== 2016-04-21 18:45:05 UTC Running &quot;bosh-init deploy /var/tempest/workspaces/default/deployments/bosh.yml&quot;
  Deployment manifest: '/var/tempest/workspaces/default/deployments/bosh.yml'
  Deployment state: '/var/tempest/workspaces/default/deployments/bosh-state.json'

  Started validating
    Validating release 'bosh'... Finished (00:00:08)
    Validating release 'bosh-vsphere-cpi'... Finished (00:00:00)
    Validating release 'uaa'... Finished (00:00:06)
    Validating cpi release... Finished (00:00:00)
    Validating deployment manifest... Finished (00:00:00)
</code></pre>

<p><code>pcf apply-changes</code> automatically tails the logs for the installation process
it started. If this gets aborted for any reason, you can always tail the logs
of the most recent installation:</p>
<pre><code class="bash">$ pcf logs
</code></pre>

<h2 id="removing-tiles">Removing Tiles</h2>
<p>To uninstall a tile:</p>
<pre><code class="bash">$ pcf uninstall test-tile
</code></pre>

<p>If you accumulate a lot of uninstalled tiles or old versions, you can clean
up Ops Manager's available products (and disk space):</p>
<pre><code class="bash">$ pcf delete-unused-products
</code></pre>

<h2 id="accessing-elastic-runtime">Accessing Elastic Runtime</h2>
<p>To see details about the Elastic Runtime of your PCF environment:</p>
<pre><code class="bash">$ pcf cf-info
- admin_password: &lt;redacted&gt;
- admin_username: admin
- apps_domain: cfapps-04.example.com
- system_domain: run-04.example.com
- system_services_password: &lt;redacted&gt;
- system_services_username: system_services
</code></pre>

<p>To target your <code>cf</code> command line at this PCF environment:</p>
<pre><code class="bash">$ pcf target
Setting api endpoint to api.example.com...
OK

API endpoint:   https://api.example.com (API version: 2.52.0)   
User:           admin   
Org:            my-org
Space:          my-space
API endpoint: https://api.example.com
Authenticating...
OK

...
</code></pre></div>
            
        </div>

        <footer class="col-md-12">
            <hr>
            
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        <script src="../js/jquery-1.10.2.min.js"></script>
        <script src="../js/bootstrap-3.0.3.min.js"></script>
        <script src="../js/highlight.pack.js"></script>
        <script>var base_url = '..';</script>
        <script data-main="../mkdocs/js/search.js" src="../mkdocs/js/require.js"></script>
        <script src="../js/base.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>

    </body>
</html>
